<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Collinear spin and magnetic systems · DFTK.jl</title><link rel="canonical" href="https://juliamolsim.github.io/DFTK.jl/stable/examples/collinear_magnetism/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">DFTK.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../guide/parallelisation/">Timings and parallelisation</a></li><li><a class="tocitem" href="../../guide/density_functional_theory/">Density-functional theory</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../pymatgen/">Creating supercells with pymatgen</a></li><li><a class="tocitem" href="../ase/">Creating slabs with ASE</a></li><li><a class="tocitem" href="../geometry_optimization/">Geometry optimization</a></li><li class="is-active"><a class="tocitem" href>Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../gross_pitaevskii_2D/">Gross-Pitaevskii equation with magnetism</a></li><li><a class="tocitem" href="../cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../custom_potential/">Custom potential</a></li></ul></li><li><span class="tocitem">Advanced topics</span><ul><li><a class="tocitem" href="../../advanced/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../advanced/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../advanced/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../advanced/symmetries/">Crystal symmetries</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Collinear spin and magnetic systems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Collinear spin and magnetic systems</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/examples/collinear_magnetism.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Collinear-spin-and-magnetic-systems"><a class="docs-heading-anchor" href="#Collinear-spin-and-magnetic-systems">Collinear spin and magnetic systems</a><a id="Collinear-spin-and-magnetic-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Collinear-spin-and-magnetic-systems" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=dev/examples/collinear_magnetism.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/dev/examples/collinear_magnetism.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>In this example we consider iron in the BCC phase. To show that this material is ferromagnetic we will model it once allowing collinear spin polarization and once without and compare the resulting SCF energies. In particular the ground state can only be found if collinear spins are allowed.</p><p>First we setup BCC iron without spin polarization using a single iron atom inside the unit cell.</p><pre><code class="language-julia">using DFTK

a = 5.42352  # Bohr
lattice = a / 2 * [[-1  1  1];
                   [ 1 -1  1];
                   [ 1  1 -1]]
Fe = ElementPsp(:Fe, psp=load_psp(&quot;hgh/lda/Fe-q8.hgh&quot;))
atoms = [Fe =&gt; [zeros(3)]];</code></pre><p>To get the ground-state energy we use an LDA model and rather moderate discretisation parameters.</p><pre><code class="language-julia">kgrid = [3, 3, 3]  # k-point grid (Regular Monkhorst-Pack grid)
Ecut = 15          # kinetic energy cutoff in Hartree
model_nospin = model_LDA(lattice, atoms, temperature=0.01)
basis_nospin = PlaneWaveBasis(model_nospin, Ecut; kgrid=kgrid)

scfres_nospin = self_consistent_field(basis_nospin, tol=1e-6, mixing=KerkerMixing())

scfres_nospin.energies</code></pre><pre class="documenter-example-output">Energy breakdown:
    Kinetic             15.9216544
    AtomicLocal         -5.0696972
    AtomicNonlocal      -5.2207343
    Ewald               -21.4723040
    PspCorrection       1.8758831 
    Hartree             0.7794486 
    Xc                  -3.4437969
    Entropy             -0.0182879

    total               -16.647834303603
</pre><p>Since we did not specify any initial magnetic moment on the iron atom, DFTK will automatically assume that a calculation with only spin-paired electrons should be performed. As a result the obtained ground state features no spin-polarization.</p><p>Now we repeat the calculation, but give the iron atom an initial magnetic moment. For specifying the magnetic moment pass the desired excess of spin-up over spin-down electrons at each centre to the <code>Model</code> and the guess density functions. In this case we seek the state with as many spin-parallel <span>$d$</span>-electrons as possible. In our pseudopotential model the 8 valence electrons are 2 pair of <span>$s$</span>-electrons, 1 pair of <span>$d$</span>-electrons and 4 unpaired <span>$d$</span>-electrons giving a desired magnetic moment of <code>4</code> at the iron centre. The structure (i.e. pair mapping and order) of the <code>magnetic_moments</code> array needs to agree with the <code>atoms</code> array and <code>0</code> magnetic moments need to be specified as well.</p><pre><code class="language-julia">magnetic_moments = [Fe =&gt; [4, ]]</code></pre><pre class="documenter-example-output">1-element Array{Pair{ElementPsp,Array{Int64,1}},1}:
 ElementPsp(26, :Fe, PspHgh(8, 0.61, [0.0, 0.0, 0.0, 0.0], 2, [0.454482, 0.63890282, 0.30873177], [[3.01664046 -1.00040646 0.79478164; -1.00040646 2.58303836 -2.05211737; 0.79478164 -2.05211737 3.25763534], [1.49964199 -0.13812935; -0.13812935 0.32687369], [-9.14535371]], &quot;hgh/lda/fe-q8.hgh&quot;, &quot;Fe GTH-PADE-q8 GTH-LDA-q8&quot;)) =&gt; [4]</pre><div class="admonition is-success"><header class="admonition-header">Units of the magnetisation and magnetic moments in DFTK</header><div class="admonition-body"><p>Unlike all other quantities magnetisation and magnetic moments in DFTK are given in units of the Bohr magneton <span>$μ_B$</span>, which in atomic units has the value <span>$\frac{1}{2}$</span>. Since <span>$μ_B$</span> is the magnetic moment of a single electron the advantage is that one can directly think of these quantities as the excess of spin-up electrons or spin-up electron density.</p></div></div><p>We repeat the calculation using the same model as before. DFTK now detects the non-zero moment and switches to a collinear calculation.</p><pre><code class="language-julia">model = model_LDA(lattice, atoms, magnetic_moments=magnetic_moments, temperature=0.01)
basis = PlaneWaveBasis(model, Ecut; kgrid=kgrid)
ρspin = guess_spin_density(basis, magnetic_moments)
scfres = self_consistent_field(basis, tol=1e-10, ρspin=ρspin, mixing=KerkerMixing())

scfres.energies</code></pre><pre class="documenter-example-output">Energy breakdown:
    Kinetic             16.3015652
    AtomicLocal         -5.2260639
    AtomicNonlocal      -5.4136145
    Ewald               -21.4723040
    PspCorrection       1.8758831 
    Hartree             0.8201414 
    Xc                  -3.5395247
    Entropy             -0.0130791

    total               -16.666996522121
</pre><div class="admonition is-info"><header class="admonition-header">Model and magnetic moments</header><div class="admonition-body"><p>DFTK does not store the <code>magnetic_moments</code> inside the <code>Model</code>, but only uses them to determine the lattice symmetries. This step was taken to keep <code>Model</code> (which contains the physical model) independent of the details of the numerical details such as the initial guess for the spin density.</p></div></div><p>In direct comparison we notice the first, spin-paired calculation to be a little higher in energy</p><pre><code class="language-julia">println(&quot;No magnetization: &quot;, scfres_nospin.energies.total)
println(&quot;Magnetic case:    &quot;, scfres.energies.total);</code></pre><pre class="documenter-example-output">No magnetization: -16.64783430360325
Magnetic case:    -16.66699652212109</pre><p>Notice that with the small cutoffs we use to generate the online documentation the calculation is far from converged. With more realistic parameters a larger energy difference of about 0.1 Hartree is obtained.</p><p>The spin polarization in the magnetic case is visible if we consider the occupation of the spin-up and spin-down Kohn-Sham orbitals. Especially for the <span>$d$</span>-orbitals these differ rather drastically. For example for the first <span>$k$</span>-point:</p><pre><code class="language-julia">iup   = 1
idown = iup + length(scfres.basis.kpoints) ÷ 2
@show scfres.occupation[iup]
@show scfres.occupation[idown];</code></pre><pre class="documenter-example-output">scfres.occupation[iup] = [1.0, 0.9999988139216373, 0.9999988139213628, 0.9999988139208976, 0.9585649911982553, 0.9585649748437947, 1.1540323419068096e-29, 1.1540321104012553e-29, 1.1540315336776227e-29, 1.395696540499569e-31, 1.3956960729489287e-31, 1.3956959302898489e-31, 1.0609918201528862e-45, 8.577009592254984e-47, 8.5770037920071905e-47]
scfres.occupation[idown] = [1.0, 0.8327413810134626, 0.8327413458392319, 0.8327413276897943, 7.846399239349971e-6, 7.846392923022553e-6, 1.549308857147181e-32, 1.5493075151431284e-32, 1.5493074479304513e-32, 9.808656004426316e-34, 9.808653892095822e-34, 9.808649915333789e-34, 6.71709989129862e-49, 6.717098862412307e-49, 3.611529635389201e-51]</pre><p>Similarly the eigenvalues differ</p><pre><code class="language-julia">@show scfres.eigenvalues[iup]
@show scfres.eigenvalues[idown];</code></pre><pre class="documenter-example-output">scfres.eigenvalues[iup] = [-0.06926787947904389, 0.35688220139684823, 0.35688220371092333, 0.35688220763217077, 0.4619176592142027, 0.46191766333183104, 1.1596478264321206, 1.1596478284381786, 1.159647833435646, 1.2037982141996457, 1.2037982175495912, 1.2037982185717269, 1.5289020217468736, 1.5540549119033673, 1.554054918665922]
scfres.eigenvalues[idown] = [-0.030405538650113466, 0.47727895244234675, 0.477278954967722, 0.47727895627078204, 0.6108852512059088, 0.6108852592559446, 1.225779911829291, 1.2257799204912476, 1.2257799209250717, 1.253377050402066, 1.2533770525556034, 1.2533770566099445, 1.602550901991122, 1.602550903522864, 1.6548078547837548]</pre><div class="admonition is-info"><header class="admonition-header">k-points in collinear calculations</header><div class="admonition-body"><p>For collinear calculations the <code>kpoints</code> field of the <code>PlaneWaveBasis</code> object contains each <span>$k$</span>-point coordinate twice, once associated with spin-up and once with down-down. The list first contains all spin-up <span>$k$</span>-points and then all spin-down <span>$k$</span>-points, such that <code>iup</code> and <code>idown</code> index the same <span>$k$</span>-point, but differing spins.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../geometry_optimization/">« Geometry optimization</a><a class="docs-footer-nextpage" href="../polarizability/">Polarizability by linear response »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 7 October 2020 11:00">Wednesday 7 October 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
